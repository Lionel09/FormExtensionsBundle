!function(t,e,o){function i(e,o){this.element=e;this.options=t.extend({search_input_el:null,search_action_el:null,search_error_el:null,current_position_el:null,default_lat:"1",default_lng:"-1",default_zoom:5,lat_field:null,lng_field:null,callback:function(){},error_handler:function(){}},a,o),this._defaults=a,this._name=n,this.geocoder=new google.maps.Geocoder,this._init()}var n="googleMap",a=(e.document,{});i.prototype={_init:function(){var e=this,o=new google.maps.LatLng(this.options.default_lat,this.options.default_lng),i={zoom:this.options.default_zoom,center:o,mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(this.element,i),this.addMarker(o),google.maps.event.addListener(this.marker,"dragend",function(){var t=e.marker.getPosition();e.map.panTo(t),e.updateLocation(t)}),google.maps.event.addListener(this.map,"click",function(t){e.insertMarker(t.latLng)}),this.options.search_action_el.click(t.proxy(this.searchAddress,this)),this.options.current_position_el.click(t.proxy(this.currentPosition,this))},searchAddress:function(t){t.preventDefault();var e=this,o=this.options.search_input_el.val();this.geocoder.geocode({address:o},function(t,o){o==google.maps.GeocoderStatus.OK?(e.map.setCenter(t[0].geometry.location),e.map.setZoom(16),e.insertMarker(t[0].geometry.location)):e.settings.error_callback(e.options.search_error_el,o)})},currentPosition:function(t){t.preventDefault();var e=this;navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){var o=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);e.insertMarker(o),e.map.setCenter(o),e.map.setZoom(16)},function(t){e.options.error_callback(e.options.search_error_el,t)}):e.options.error_callback(e.options.search_error_el,"Your broswer does not support geolocation")},updateLocation:function(t){this.options.lat_field.val(t.lat()),this.options.lng_field.val(t.lng()),this.options.callback(t,this)},addMarker:function(t){this.marker?(this.marker.setMap(this.map),this.marker.setPosition(t)):this.marker=new google.maps.Marker({map:this.map,position:t,draggable:!0})},insertMarker:function(t){this.removeMarker(),this.addMarker(t),this.updateLocation(t)},removeMarker:function(){this.marker!=o&&this.marker.setMap(null)}},t.fn[n]=function(e){var a=arguments;if(e===o||"object"==typeof e)return this.each(function(){t.data(this,"plugin_"+n)||t.data(this,"plugin_"+n,new i(this,e))});if("string"==typeof e&&"_"!==e[0]&&"init"!==e){var r;return this.each(function(){var o=t.data(this,"plugin_"+n);o instanceof i&&"function"==typeof o[e]&&(r=o[e].apply(o,Array.prototype.slice.call(a,1))),"destroy"===e&&t.data(this,"plugin_"+n,null)}),r!==o?r:this}}}(jQuery,window);
