!function(e,t,n){function i(t,n){this.element=t,this.$element=e("#"+t.id),this.options=e.extend({},l,n),this._defaults=l,this._name=o,this._init()}var o="bootstrapCollection",l=(t.document,{allow_add:!1,allow_delete:!1,sortable:!1,sortable_field:"position",prototype_name:"__name__",trans:{new_label:"New item",confirm:"Are you sure you want to delete this element?",confirm_batch:"Are you sure you want to delete all selected elements?"},javascript:function(){}});i.prototype={_init:function(){var t=this;this.options.allow_add&&(this.$new=e("#"+this.element.id+"_toolbar > .new"),this.nextId=this.$element.children(".collection").children(".collection-item-wrapper").length,this.$new.on("click",function(n){n.preventDefault();var i=e.Event("adding");t.$element.trigger(i),i.isDefaultPrevented()||(t._onAdd(),t.$element.trigger("added"))})),this.options.allow_delete&&(e("."+this.element.id+"_actions .delete").click(function(n){n.preventDefault();var i=e.Event("deleting"),o=e(this).closest(".collection-item");t.$element.trigger(i,[o]),i.isDefaultPrevented()||(t._onDelete(this),t.$element.trigger("deleted",[o]))}),this.$toggleAll=e("#"+this.element.id+'_toolbar > .btn-toggle > input[name="toggle"]'),this.$toggleAll.on("change",function(){t._onToggleAll()}),e("#"+this.element.id+"_toolbar > .batch-delete").click(function(){var n=e.Event("deleting-all");t.$element.trigger(n),n.isDefaultPrevented()||(t._onDeleteAll(),t.$element.trigger("deleted-all"))})),this.options.sortable&&e("#"+this.element.id+" > .collection").sortable({update:function(){t._onChange()},cancel:"a, button, img, input, textarea, select, iframe, .cke div, .cke span",start:function(n,i){"undefined"!=typeof CKEDITOR&&(t.ckeConfigs=[],e("textarea",i.item).each(function(){var n=e(this).attr("id");if(CKEDITOR.instances[n]){var i=e(this).next(".cke").clone().addClass("cloned");t.ckeConfigs[n]=CKEDITOR.instances[n].config,CKEDITOR.instances[n].destroy(),e(this).hide().after(i)}}))},stop:function(n,i){"undefined"!=typeof CKEDITOR&&e("textarea",i.item).each(function(){var n=e(this).attr("id");t.ckeConfigs[n]&&(CKEDITOR.replace(n,t.ckeConfigs[n]),e(this).next(".cloned").remove())})}})},_onAdd:function(){var n=e("#"+this.element.id).data("prototype"),i=this.nextId;if(n=n.replace(new RegExp("__name__label__","g"),this.options.trans.new_label),n=n.replace(new RegExp(this.options.prototype_name,"g"),i),$new_item=e(n),this.options.allow_delete){var o=this;$new_item.find(".delete").click(function(){var t=e.Event("deleting"),n=e(this).closest(".collection-item-wrapper");o.$element.trigger(t,[n]),t.isDefaultPrevented()||(o._onDelete(this),o.$element.trigger("deleted",[n]))})}return this.nextId++,e("#"+this.element.id+" > .collection").append($new_item),this.options.javascript.call(t,this.element.id+"_"+i),this.options.sortable&&this._onChange(),$new_item},_onDelete:function(t){confirm(this.options.trans.confirm)&&(e(t).closest(".collection-item-wrapper").remove(),this.options.sortable&&this._onChange())},_onChange:function(){e('[id^="'+this.element.id+'"][id$="'+this.options.sortable_field+'"]').each(function(t){e(this).val(t)})},_onToggleAll:function(){this.$toggleAll.is(":checked")?(this.$toggleAll.prop("checked",!0),e("."+this.element.id+'_actions > .btn-toggle > input[name="delete"]').prop("checked",!0)):(this.$toggleAll.prop("checked",!1),e("."+this.element.id+'_actions > .btn-toggle > input[name="delete"]').prop("checked",!1))},_onDeleteAll:function(){confirm(this.options.trans.confirm_batch)&&(e("."+this.element.id+'_actions > .btn-toggle > input[name="delete"]:checked').each(function(){e(this).closest(".collection-item-wrapper").remove()}),this.options.sortable&&this._onChange(),this.$toggleAll.prop("checked",!1))},_clear:function(){this.$element.find(".collection > .collection-item-wrapper").remove()},add:function(){return this.options.allow_add?this._onAdd():void 0},clear:function(){this.options.allow_delete&&this._clear()}},e.fn[o]=function(t){var l=arguments;if(t===n||"object"==typeof t)return this.each(function(){e.data(this,"plugin_"+o)||e.data(this,"plugin_"+o,new i(this,t))});if("string"==typeof t&&"_"!==t[0]&&"init"!==t){var s;return this.each(function(){var n=e.data(this,"plugin_"+o);n instanceof i&&"function"==typeof n[t]&&(s=n[t].apply(n,Array.prototype.slice.call(l,1))),"destroy"===t&&e.data(this,"plugin_"+o,null)}),s!==n?s:this}}}(jQuery,window);
